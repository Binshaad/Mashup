<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Integrated Navigation & Route Monitoring System</title>
<style>
    body {
        display: flex;
        font-family: Arial, sans-serif;
        margin: 0;
    }
    canvas {
        border: 1px solid #333;
        background: #eef;
    }
    #panel {
        width: 300px;
        padding: 15px;
        background: #f5f5f5;
        border-left: 2px solid #ccc;
    }
    button, input {
        width: 100%;
        margin-top: 8px;
        padding: 6px;
    }
</style>
</head>

<body>

<canvas id="map" width="800" height="600"></canvas>

<div id="panel">
    <h3>Navigation Info</h3>
    <p><b>Position:</b> <span id="pos">-</span></p>
    <p><b>Speed:</b> <span id="speed">5</span> units/sec</p>
    <p><b>Heading:</b> <span id="heading">0</span>Â°</p>
    <p><b>Distance to WP:</b> <span id="dist">-</span></p>
    <p><b>ETA:</b> <span id="eta">-</span> sec</p>

    <button onclick="toggleMode()">Switch Orientation</button>
    <button onclick="clearRoute()">Clear Route</button>

    <label>Speed Control</label>
    <input type="range" min="1" max="10" value="5" onchange="updateSpeed(this.value)">
</div>

<script>
const canvas = document.getElementById("map");
const ctx = canvas.getContext("2d");

let waypoints = [];
let currentWP = 0;
let vessel = { x: 100, y: 100, heading: 0 };
let speed = 5;
let headingUp = false;

// Add waypoint on click
canvas.addEventListener("click", e => {
    waypoints.push({ x: e.offsetX, y: e.offsetY });
});

// Update speed
function updateSpeed(val) {
    speed = parseInt(val);
    document.getElementById("speed").innerText = speed;
}

// Clear route
function clearRoute() {
    waypoints = [];
    currentWP = 0;
}

// Toggle orientation
function toggleMode() {
    headingUp = !headingUp;
}

// Distance calculation
function distance(a, b) {
    return Math.hypot(b.x - a.x, b.y - a.y);
}

// Simulation loop
function update() {
    if (waypoints.length > 0 && currentWP < waypoints.length) {
        let target = waypoints[currentWP];
        let dx = target.x - vessel.x;
        let dy = target.y - vessel.y;
        let dist = Math.hypot(dx, dy);

        vessel.heading = Math.atan2(dy, dx);

        if (dist < speed) {
            currentWP++;
        } else {
            vessel.x += Math.cos(vessel.heading) * speed;
            vessel.y += Math.sin(vessel.heading) * speed;
        }

        document.getElementById("dist").innerText = dist.toFixed(1);
        document.getElementById("eta").innerText = (dist / speed).toFixed(1);
    }

    document.getElementById("pos").innerText =
        `${vessel.x.toFixed(1)}, ${vessel.y.toFixed(1)}`;
    document.getElementById("heading").innerText =
        (vessel.heading * 180 / Math.PI).toFixed(1);

    draw();
    requestAnimationFrame(update);
}

// Draw everything
function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    ctx.save();
    if (headingUp) {
        ctx.translate(canvas.width / 2, canvas.height / 2);
        ctx.rotate(-vessel.heading);
        ctx.translate(-canvas.width / 2, -canvas.height / 2);
    }

    // Draw route
    ctx.strokeStyle = "blue";
    ctx.beginPath();
    waypoints.forEach((wp, i) => {
        if (i === 0) ctx.moveTo(wp.x, wp.y);
        else ctx.lineTo(wp.x, wp.y);
    });
    ctx.stroke();

    // Highlight active leg
    if (currentWP < waypoints.length - 1) {
        ctx.strokeStyle = "red";
        ctx.beginPath();
        ctx.moveTo(vessel.x, vessel.y);
        ctx.lineTo(waypoints[currentWP].x, waypoints[currentWP].y);
        ctx.stroke();
    }

    // Draw waypoints
    waypoints.forEach(wp => {
        ctx.fillStyle = "black";
        ctx.beginPath();
        ctx.arc(wp.x, wp.y, 5, 0, Math.PI * 2);
        ctx.fill();
    });

    // Draw vessel
    ctx.translate(vessel.x, vessel.y);
    ctx.rotate(vessel.heading);
    ctx.fillStyle = "green";
    ctx.beginPath();
    ctx.moveTo(15, 0);
    ctx.lineTo(-10, -7);
    ctx.lineTo(-10, 7);
    ctx.closePath();
    ctx.fill();

    ctx.restore();
}

// Start simulation
update();
</script>

</body>
</html>
